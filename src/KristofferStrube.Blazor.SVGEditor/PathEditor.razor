<g>
    <path d="@Path.Instructions.AsString()" fill="@Path.Fill" stroke="@Path.Stroke" stroke-width="@Path.StrokeWidth" @onmousedown="Select" />
    @if (Path.Selected)
    {
        @for (int i = 0; i < Path.Instructions.Count; i++)
        {
            var j = i;
            if (Path.Instructions[i]
                is LineInstruction
                or MoveInstruction
                or HorizontalLineInstruction
                or VerticalLineInstruction
                or CubicBézierCurveInstruction)
            {
                <circle @onmousedown="() => AnchorSelect(j, 0)" cx="@Path.Instructions[i].EndPosition.x" cy="@Path.Instructions[i].EndPosition.y" r="6" stroke-width="2" stroke="black" fill="transparent" />
            }
            if (Path.Instructions[i]
                is CubicBézierCurveInstruction cubicCurve)
            {
                <line x1="@cubicCurve.StartPosition.x" y1="@cubicCurve.StartPosition.y" x2="@cubicCurve.x1" y2="@cubicCurve.y1" stroke-dasharray="4" stroke="black" stroke-width="2" />
                <line x1="@cubicCurve.x2" y1="@cubicCurve.y2" x2="@cubicCurve.EndPosition.x" y2="@cubicCurve.EndPosition.y" stroke-dasharray="4" stroke="black" stroke-width="2" />
                <circle @onmousedown="() => AnchorSelect(j, 1)" cx="@cubicCurve.x1" cy="@cubicCurve.y1" r="6" stroke-width="2" stroke="black" fill="transparent" />
                <circle @onmousedown="() => AnchorSelect(j, 2)" cx="@cubicCurve.x2" cy="@cubicCurve.y2" r="6" stroke-width="2" stroke="black" fill="transparent" />
            }
        }
    }
</g>

@code {
    [Parameter]
    public Path Path { get; set; }

    public void AnchorSelect(int segment, int anchor)
    {
        if (Path.EditMode != EditMode.Add)
        {
            Path.CurrentInstruction = segment;
            Path.CurrentAnchor = anchor;
            Path.EditMode = EditMode.MoveAnchor;
        }
    }

    public void Select(MouseEventArgs eventArgs)
    {
        if (Path.SVG.CurrentShape == null || Path.SVG.CurrentShape.EditMode == EditMode.None)
        {
            Path.SVG.CurrentShape = Path;
            Path.Panner = (x: eventArgs.OffsetX, y: eventArgs.OffsetY);
            Path.EditMode = EditMode.Move;
        }
    }
}
